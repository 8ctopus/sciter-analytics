<html
    window-width="800dip"
    window-height="600dip"
>
<head>
<style>

@import url(vendor/8ctopus/sciter-logger/src/logger.css);

body {
    border-spacing: 1em;
}

</style>
<script type="module">

import {logger} from "vendor/8ctopus/sciter-logger/src/logger.js";
import * as utils from "vendor/8ctopus/sciter-utils/src/utils.js";
import {uuid} from "@sciter";

// initialize logger
logger.init();

// attach logger to console
logger.attach();

// capture unhandled exceptions
logger.capture();

document.on("ready", function() {
    logger.plaintext(document.$("plaintext#logger"));

    // log sciter version
    console.debug(utils.sciterInfo());

    // center window on screen
    utils.centerWindow("screen");

    // add support for F5 reload
    utils.addReloadWindow();

    // close window on escape key press
    utils.closeWindowOnEscape();

    // bring window to front
    utils.windowToFront();

    // focus window
    utils.focusWindow();

    console.log(`Universally unique identifier - ` + uuid());
});

const headers = {
    "Content-Type": "application/json; charset=utf-8",
    "Accept": "*/*",
};

document.on("click", "button#httpbin", function() {
    const url = "https://httpbin.org/post";

    const body = JSON.stringify({
        uuid: uuid(),
        event: "button clicked",
    });

    myfetch(url, headers, body);
});

// amplitude test
document.on("click", "button#amplitude", function() {
    const url = "https://api2.amplitude.com/2/httpapi";

    const body = JSON.stringify({
      "api_key": "my_amplitude_api_key",
      "events": [{
          "user_id": "datamonster@gmail.com",
          "device_id": "C8F9E604-F01A-4BD9-95C6-8E5357DF265D",
          "event_type": "watch_tutorial",
          "time": 1396381378123,
          "event_properties": {
            "load_time": 0.8371,
            "source": "notification",
            "dates": [
              "monday",
              "tuesday"
            ]
          },
          "app_version": "2.1.3",
          "platform": "iOS",
          "os_name": "Android",
          "os_version": "4.2.2",
          "device_brand": "Verizon",
          "device_manufacturer": "Apple",
          "device_model": "iPhone 9,1",
          "carrier": "Verizon",
          "country": "United States",
          "region": "California",
          "city": "San Francisco",
          "dma": "San Francisco-Oakland-San Jose, CA",
          "language": "English",
          "ip": "127.0.0.1",
        }
      ]
    });

    myfetch(url, headers, body);
});

async function myfetch(url, headers, body)
{
    const response = await fetch(url, {
        method: "POST",
        cache: "no-cache",
        headers: headers,
        body: body,
    });

    console.line();
    console.log(`response status - ${response.status}`);

    const json = await response.json();

    console.log(json);
}

</script>
</head>
<body>
    <button #httpbin>httpbin</button>
    <button #amplitude>amplitude</button>
    <plaintext #logger readonly />
</body>
</html>
